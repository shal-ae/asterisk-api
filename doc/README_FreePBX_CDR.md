# FreePBX Call History API

–≠—Ç–æ—Ç API –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –¥–æ—Å—Ç—É–ø –∫ –∂—É—Ä–Ω–∞–ª—É –∑–≤–æ–Ω–∫–æ–≤ FreePBX —Å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å—é —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏, –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∏ –∏ –ø–æ–ª—É—á–µ–Ω–∏—è —Å—Å—ã–ª–æ–∫ –Ω–∞ –∞—É–¥–∏–æ–∑–∞–ø–∏—Å–∏ —Ä–∞–∑–≥–æ–≤–æ—Ä–æ–≤.

## üîê –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è

–í—Å–µ –∑–∞–ø—Ä–æ—Å—ã –¥–æ–ª–∂–Ω—ã —Å–æ–¥–µ—Ä–∂–∞—Ç—å –∑–∞–≥–æ–ª–æ–≤–æ–∫:

```
Authorization: Bearer YOUR_API_KEY
```

## üîó Endpoint

```
GET /api/cdr.php
```

## üì• –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –∑–∞–ø—Ä–æ—Å–∞ (GET)

| –ü–∞—Ä–∞–º–µ—Ç—Ä       | –¢–∏–ø     | –û–ø–∏—Å–∞–Ω–∏–µ                                                             |
|----------------|----------|----------------------------------------------------------------------|
| `src`          | —Å—Ç—Ä–æ–∫–∞  | –ù–æ–º–µ—Ä –≤—ã–∑—ã–≤–∞—é—â–µ–≥–æ                                                    |
| `dst`          | —Å—Ç—Ä–æ–∫–∞  | –ù–æ–º–µ—Ä –≤—ã–∑—ã–≤–∞–µ–º–æ–≥–æ                                                    |
| `date_from`    | –¥–∞—Ç–∞ (`YYYY-MM-DD`) | –ù–∞—á–∞–ª–æ –¥–∏–∞–ø–∞–∑–æ–Ω–∞ –¥–∞—Ç                                                 |
| `date_to`      | –¥–∞—Ç–∞ (`YYYY-MM-DD`) | –ö–æ–Ω–µ—Ü –¥–∏–∞–ø–∞–∑–æ–Ω–∞ –¥–∞—Ç                                                  |
| `answered`     | `0` / `1` | –§–∏–ª—å—Ç—Ä –ø–æ —Å—Ç–∞—Ç—É—Å—É: `1` ‚Äî —Ç–æ–ª—å–∫–æ –æ—Ç–≤–µ—á–µ–Ω–Ω—ã–µ, `0` ‚Äî —Ç–æ–ª—å–∫–æ –ø—Ä–æ–ø—É—â–µ–Ω–Ω—ã–µ |
| `min_duration` | —Ü–µ–ª–æ–µ   | –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å (–≤ —Å–µ–∫—É–Ω–¥–∞—Ö)                                |
| `page`         | —Ü–µ–ª–æ–µ   | –ù–æ–º–µ—Ä —Å—Ç—Ä–∞–Ω–∏—Ü—ã (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 1)                                      |
| `per_page`     | —Ü–µ–ª–æ–µ   | –ö–æ–ª-–≤–æ –∑–∞–ø–∏—Å–µ–π –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 100, –º–∞–∫—Å–∏–º—É–º 1000)         |

## üì¶ –ü—Ä–∏–º–µ—Ä –∑–∞–ø—Ä–æ—Å–∞

```http
GET /api/cdr_api.php?date_from=2025-05-01&date_to=2025-05-10&answered=1&min_duration=10&page=1
Authorization: Bearer my-secret-key-123
```

## ‚úÖ –û—Ç–≤–µ—Ç

–£—Å–ø–µ—à–Ω—ã–π –æ—Ç–≤–µ—Ç –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç JSON:

```json
{
  "status": "OK",
  "page": 1,
  "per_page": 20,
  "total": 42,
  "pages_count": 3,
  "content": [
    {
      "linkedid": "171680001.001",
      "items": [
        {
          "uniqueid": "171680001.001",
          "calldate": "2025-05-01 12:34:56",
          "src": "1001",
          "dst": "83425554433",
          "channel": "PJSIP/1001-00000123",
          "dstchannel": "PJSIP/mts-trunk-00000124",
          "src_ext": "1001",
          "dst_ext": null,
          "duration": 34,
          "billsec": 30,
          "disposition": "ANSWERED",
          "recording_url": "2025/05/01/out-8342-1001-171680001.001.wav/2025/05/01/out-8342-1001-171680001.001.wav",
          "src_trunk": "PJSIP/1001",
          "dst_trunk": "mts-trunk"
        }
      ]
    }
  ]
}
```

## üîé –ü–æ–ª—è –≤ `items[]`

| –ü–æ–ª–µ                     | –û–ø–∏—Å–∞–Ω–∏–µ                                                  |
|--------------------------|-----------------------------------------------------------|
| `uniqueid`               | –£–Ω–∏–∫–∞–ª—å–Ω—ã–π ID –≤—ã–∑–æ–≤–∞                                      |
| `linkedid`               | –û–±—â–∏–π ID —Ü–µ–ø–æ—á–∫–∏ –≤—ã–∑–æ–≤–æ–≤                                  |
| `calldate`               | –î–∞—Ç–∞ –∏ –≤—Ä–µ–º—è –∑–≤–æ–Ω–∫–∞                                       |
| `src`, `dst`             | –ù–æ–º–µ—Ä–∞ –≤—ã–∑–æ–≤–∞                                             |
| `channel`, `dstchannel`  | –ö–∞–Ω–∞–ª—ã Asterisk                                           |
| `src_ext`, `dst_ext`     | –í–Ω—É—Ç—Ä–µ–Ω–Ω–∏–µ –Ω–æ–º–µ—Ä–∞                                         |
| `duration`               | –ü–æ–ª–Ω–∞—è –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å (—Å–µ–∫.)                                |
| `billsec`                | –í—Ä–µ–º—è —Ä–∞–∑–≥–æ–≤–æ—Ä–∞ (—Å–µ–∫.)                                    |
| `disposition`            | –°—Ç–∞—Ç—É—Å –∑–≤–æ–Ω–∫–∞ (`ANSWERED`, `NO ANSWER`, `FAILED`, `BUSY`) |
| `recording_url`          | –°—Å—ã–ª–∫–∞ –Ω–∞ –∑–∞–ø–∏—Å—å —Ä–∞–∑–≥–æ–≤–æ—Ä–∞ (–µ—Å–ª–∏ –µ—Å—Ç—å)                    |
| `src_trunk`, `dst_trunk` | –ò–º–µ–Ω–∞ —Ç—Ä–∞–Ω–∫–æ–≤                                      |

## ‚ö†Ô∏è –ü—Ä–∏–º–µ—á–∞–Ω–∏—è

- –§–∞–π–ª—ã –∑–∞–ø–∏—Å–µ–π –∏—â—É—Ç—Å—è –≤ `/var/spool/asterisk/monitor/YYYY/MM/DD/` —Å —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è–º–∏ `.wav` –∏–ª–∏ `.mp3`
- –ü–∞–≥–∏–Ω–∞—Ü–∏—è —Ä–∞–±–æ—Ç–∞–µ—Ç –ø–æ CDR-–∑–∞–ø–∏—Å—è–º, –∞ –Ω–µ –ø–æ –≥—Ä—É–ø–ø–∞–º `linkedid`

## üõ°Ô∏è –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

- –í—Å–µ –∑–∞–ø—Ä–æ—Å—ã —Ç—Ä–µ–±—É—é—Ç API-–∫–ª—é—á
- –ù–µ –∑–∞–±—É–¥—å –æ–≥—Ä–∞–Ω–∏—á–∏—Ç—å –¥–æ—Å—Ç—É–ø –∫ `/api/` –ø–æ IP, —á–µ—Ä–µ–∑ `.htaccess` –∏–ª–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —Ñ–∞–µ—Ä–≤–æ–ª–∞
- –ü—Ä–∞–≤–∞ –Ω–∞ —á—Ç–µ–Ω–∏–µ –∑–∞–ø–∏—Å–µ–π –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å —É Apache/Asterisk

## üß∞ –ü—Ä–∏–º–µ—Ä—ã

### –ü–æ–ª—É—á–∏—Ç—å –≤—Å–µ –≤—Ö–æ–¥—è—â–∏–µ –∑–≤–æ–Ω–∫–∏ –∑–∞ –º–∞–π 2025:

```http
GET /api/cdr_api.php?date_from=2025-05-01&date_to=2025-05-31&answered=1&min_duration=10
Authorization: Bearer my-secret-key-123
```

### –ü–æ–ª—É—á–∏—Ç—å —Ç–æ–ª—å–∫–æ –ø—Ä–æ–ø—É—â–µ–Ω–Ω—ã–µ –∑–≤–æ–Ω–∫–∏:

```http
GET /api/cdr_api.php?answered=0
Authorization: Bearer my-secret-key-123
```

## üìç –ö–æ–Ω—Ç–∞–∫—Ç—ã

–†–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫: *–í–∞—à–µ –ò–º—è*  
–ü–æ–¥–¥–µ—Ä–∂–∫–∞: *email@example.com*
