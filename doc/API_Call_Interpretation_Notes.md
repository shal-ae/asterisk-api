## üîç (–æ—Ç –ò–ò, –Ω–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∞—è –¥–æ–∫–∞!)
## –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ –∏–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ü–∏–∏ –≤—ã–∑–æ–≤–æ–≤ (–≤–∞–∂–Ω–æ –¥–ª—è –ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª–µ–π API)

–ß—Ç–æ–±—ã –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –ø–æ–Ω–∏–º–∞—Ç—å –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∏ —Å—Ç—Ä—É–∫—Ç—É—Ä—É –∑–≤–æ–Ω–∫–æ–≤, –æ—Å–æ–±–µ–Ω–Ω–æ –≤—ã–∑–æ–≤–æ–≤, –∏–Ω–∏—Ü–∏–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö —á–µ—Ä–µ–∑ API (`make_call.php`), –Ω—É–∂–Ω–æ —É—á–∏—Ç—ã–≤–∞—Ç—å —Å–ª–µ–¥—É—é—â–∏–µ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:

---

### üìå 1. –í—ã–∑–æ–≤—ã, —Å–æ–∑–¥–∞–Ω–Ω—ã–µ —á–µ—Ä–µ–∑ API (make_call.php)

- –¢–∞–∫–∏–µ –≤—ã–∑–æ–≤—ã —Å–æ—Å—Ç–æ—è—Ç –∏–∑ **–¥–≤—É—Ö CDR-–∑–∞–ø–∏—Å–µ–π**, –æ–±—ä–µ–¥–∏–Ω—ë–Ω–Ω—ã—Ö –ø–æ `linkedid`.
- –í –Ω–∏—Ö –æ–¥–Ω–∞ –∑–∞–ø–∏—Å—å –±—É–¥–µ—Ç —Å–æ–¥–µ—Ä–∂–∞—Ç—å `src == dst` –∏ –∫–∞–Ω–∞–ª `Local/...` ‚Äî —ç—Ç–æ **–∏–Ω–∏—Ü–∏–∞—Ç–æ—Ä –≤—ã–∑–æ–≤–∞ (–≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π –Ω–æ–º–µ—Ä)**.
- –î—Ä—É–≥–∞—è –∑–∞–ø–∏—Å—å (–∫–∞–∫ –ø—Ä–∞–≤–∏–ª–æ, –ø–µ—Ä–≤–∞—è –≤ —Å–ø–∏—Å–∫–µ) —Å–æ–¥–µ—Ä–∂–∏—Ç:
  - —Ä–µ–∞–ª—å–Ω—ã–π `dst` (–≤–Ω–µ—à–Ω–∏–π –Ω–æ–º–µ—Ä –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è)
  - `dst_trunk` (–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–Ω—ã–π —Ç—Ä–∞–Ω–∫)
  - `recording_url` (—Ñ–∞–π–ª –∑–∞–ø–∏—Å–∏, –µ—Å–ª–∏ –µ—Å—Ç—å)

**–ü–æ—Ä—è–¥–æ–∫ –≤ –º–∞—Å—Å–∏–≤–µ `items[]` (–ø–æ —É–±—ã–≤–∞–Ω–∏—é –≤—Ä–µ–º–µ–Ω–∏):**

| –ü–æ–∑–∏—Ü–∏—è –≤ –º–∞—Å—Å–∏–≤–µ | –ó–Ω–∞—á–µ–Ω–∏–µ                        |
|-------------------|---------------------------------|
| `items[0]`        | –†–µ–∞–ª—å–Ω—ã–π –≤—ã–∑–æ–≤ (–≤–Ω–µ—à–Ω–∏–π –Ω–æ–º–µ—Ä)  |
| `end(items)`      | –í–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π –≤—ã–∑–æ–≤ (–∏–Ω–∏—Ü–∏–∞—Ç–æ—Ä)    |

---

### üß† –ö–∞–∫ –∏–∑–≤–ª–µ–∫–∞—Ç—å —Ä–µ–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ

**–ï—Å–ª–∏ `end(items)['src'] === end(items)['dst']` –∏ —ç—Ç–æ `Local/` –∫–∞–Ω–∞–ª, —Ç–æ:**

```php
$first = $items[0];           // –Ω–∞—Ä—É–∂–Ω—ã–π –∑–≤–æ–Ω–æ–∫
$last = end($items);          // –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π –≤—ã–∑–æ–≤ –∏–Ω–∏—Ü–∏–∞—Ç–æ—Ä–∞

$initiator = $last['src'];    // –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π –Ω–æ–º–µ—Ä, –∫—Ç–æ –≤—ã–∑–≤–∞–ª
$toNumber  = $first['dst'];   // –Ω–æ–º–µ—Ä –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è (–≤–Ω–µ—à–Ω–∏–π)
$trunk     = $first['dst_trunk'];
$recording = $first['recording_url'];
```

---

### ‚ö†Ô∏è –ü–æ—á–µ–º—É —ç—Ç–æ –≤–∞–∂–Ω–æ

–ï—Å–ª–∏ –ø—Ä–æ—Å—Ç–æ –∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –ø–æ–ª—è `src`, `dst` –∏ `channel` –±–µ–∑ —É—á—ë—Ç–∞ `linkedid` –∏ –ø–æ—Ä—è–¥–∫–∞, –º–æ–∂–Ω–æ:

- –æ—à–∏–±–æ—á–Ω–æ –ø—Ä–∏–Ω—è—Ç—å –≤—ã–∑–æ–≤ –∑–∞ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π
- –Ω–µ —É–≤–∏–¥–µ—Ç—å –Ω–æ–º–µ—Ä, –Ω–∞ –∫–æ—Ç–æ—Ä—ã–π —Ä–µ–∞–ª—å–Ω–æ –±—ã–ª –≤—ã–∑–æ–≤

---

### üìå –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞

–°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –≤–Ω—É—Ç—Ä–∏ API –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é:

```sql
ORDER BY calldate DESC, uniqueid DESC
```

–≠—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç, —á—Ç–æ:
- **–≤ –≥—Ä—É–ø–ø–µ CDR** –≤—ã–∑–æ–≤—ã –∏–¥—É—Ç –æ—Ç —Ñ–∏–Ω–∞–ª—å–Ω—ã—Ö —Å–æ–±—ã—Ç–∏–π (–≤–Ω–µ—à–Ω–∏–π –≤—ã–∑–æ–≤) –∫ –∏–∑–Ω–∞—á–∞–ª—å–Ω—ã–º (–∏–Ω–∏—Ü–∏–∞—Ç–æ—Ä)
- `items[0]` ‚Äî —ç—Ç–æ –≤–Ω–µ—à–Ω–∏–π –≤—ã–∑–æ–≤
- `end(items)` ‚Äî —ç—Ç–æ Local/–≤—ã–∑–æ–≤, –∏–Ω–∏—Ü–∏–∞—Ç–æ—Ä

---
